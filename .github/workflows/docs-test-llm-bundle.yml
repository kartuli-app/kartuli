name: Docs Test LLM Bundle
description: Tests LLM bundle generation process and validates output
# Triggers: PRs (docs changes), manual
# Purpose: Verify LLM bundle generation works correctly before merge
# Output: Test results and generated bundle preview

on:
  pull_request:
    branches: [main]
    paths:
      - 'docs/**'
      - 'tools/web-docs-client/**'
  workflow_dispatch:

jobs:
  test-generation:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Setup pnpm
        uses: pnpm/action-setup@v4
        with:
          version: 9.12.2
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'pnpm'
      
      - name: Install dependencies
        run: pnpm install --frozen-lockfile
      
      - name: Test LLM bundle generation
        run: |
          cd tools/web-docs-client
          echo "ğŸ” Current directory: $(pwd)"
          node scripts/generate-llm-bundle.js
          echo "âœ… LLM bundle generated successfully"
          echo "ğŸ” Checking if file exists at expected location:"
          echo "ğŸ” Expected path: $(pwd)/../../../docs/kartuli-llm.txt"
          echo "ğŸ” Absolute path: $(realpath ../../../docs/kartuli-llm.txt)"
          ls -la ../../../docs/kartuli-llm.txt || echo "âŒ File not found at relative path"
          echo "ğŸ” Checking docs directory:"
          ls -la ../../../docs/
          echo "ğŸ“„ File size: $(wc -c < ../../../docs/kartuli-llm.txt) bytes"
      
      - name: Test file content
        run: |
          echo "ğŸ“‹ First 10 lines of generated file:"
          head -10 docs/kartuli-llm.txt
          echo ""
          echo "ğŸ”— Testing GitHub raw URL format:"
          echo "https://raw.githubusercontent.com/rocescoca/kartuli/main/docs/kartuli-llm.txt"
